{% extends "base.html" %}

{% block title %}{{ page.title }} | {{ config.title }}{% endblock %}
{% block description %}{{ page.description | default(value=page.summary) | default(value=config.description) }}{% endblock %}

{% block og_title %}{{ page.title }}{% endblock %}
{% block og_description %}{{ page.description | default(value=page.summary) }}{% endblock %}
{% block og_type %}article{% endblock %}

{% block twitter_title %}{{ page.title }}{% endblock %}
{% block twitter_description %}{{ page.description | default(value=page.summary) }}{% endblock %}

{% block extra_meta %}
<!-- JSON-LD Structured Data for Person (About page) -->
{% if page.title == "About" %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "{{ config.extra.author }}",
  "url": "{{ page.permalink }}",
  "description": "{{ page.description }}",
  "knowsAbout": ["Bazi", "Four Pillars of Destiny", "Tarot", "Chinese Astrology", "Divination", "Spirituality"],
  "hasOccupation": {
    "@type": "Occupation",
    "name": "Spiritual Practitioner & Consultant",
    "description": "Bazi and Tarot reader providing consultations and insights"
  }
}
</script>
{% endif %}

<!-- JSON-LD Structured Data for Articles -->
{% if page.date %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ page.title }}",
  "description": "{{ page.description | default(value=page.summary) | default(value='') }}",
  "datePublished": "{{ page.date }}",
  "dateModified": "{{ page.updated | default(value=page.date) }}",
  "author": {
    "@type": "Person",
    "name": "{{ config.extra.author }}",
    "url": "{{ config.base_url }}/about/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ config.title }}",
    "url": "{{ config.base_url }}"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ page.permalink }}"
  },
  "url": "{{ page.permalink }}",
  {% if page.taxonomies.categories %}
  "articleSection": "{{ page.taxonomies.categories | first }}",
  {% endif %}
  {% if page.taxonomies.tags %}
  "keywords": [
    {% for tag in page.taxonomies.tags %}"{{ tag }}"{% if not loop.last %}, {% endif %}{% endfor %}
  ],
  {% endif %}
  "inLanguage": "en-US"
}
</script>

<!-- Breadcrumb Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ config.base_url }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "{{ config.base_url }}/blog/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ page.title }}",
      "item": "{{ page.permalink }}"
    }
  ]
}
</script>
{% endif %}
{% endblock %}

{% block content %}
{% import "macros/newsletter.html" as newsletter %}

<article class="blog-post">
    <div class="container">
        <!-- Post Header -->
        <header class="post-header">
            <h1 class="post-title">{{ page.title }}</h1>
            {% if page.date %}
            <div class="post-meta">
                <time datetime="{{ page.date }}">{{ page.date | date(format="%B %d, %Y") }}</time>
                {% if page.reading_time %}
                <span class="reading-time">{{ page.reading_time }} min read</span>
                {% endif %}
            </div>
            {% endif %}
            {% if page.taxonomies.categories %}
            <div class="post-categories">
                {% for category in page.taxonomies.categories %}
                <a href="{{ get_taxonomy_url(kind='categories', name=category) }}" class="category">{{ category }}</a>
                {% endfor %}
            </div>
            {% endif %}
            {% if page.taxonomies.tags %}
            <div class="post-tags">
                {% for tag in page.taxonomies.tags %}
                <a href="{{ get_taxonomy_url(kind='tags', name=tag) }}" class="tag">{{ tag }}</a>
                {% endfor %}
            </div>
            {% endif %}
        </header>

        <!-- Table of Contents (for long posts) -->
        {% if page.toc %}
        <aside class="table-of-contents">
            <h2>Table of Contents</h2>
            <ul>
            {% for h1 in page.toc %}
                <li>
                    <a href="{{ h1.permalink | safe }}">{{ h1.title }}</a>
                    {% if h1.children %}
                    <ul>
                    {% for h2 in h1.children %}
                        <li><a href="{{ h2.permalink | safe }}">{{ h2.title }}</a></li>
                    {% endfor %}
                    </ul>
                    {% endif %}
                </li>
            {% endfor %}
            </ul>
        </aside>
        {% endif %}

        <!-- Post Content -->
        <div class="post-content">
            {{ page.content | safe }}
        </div>

        <!-- Author Bio -->
        {% if page.date %}
        <aside class="author-bio">
            <div class="author-bio-content">
                <div class="author-avatar">
                    <span class="avatar-placeholder">MH</span>
                </div>
                <div class="author-info">
                    <h3 class="author-name">{{ config.extra.author }}</h3>
                    <p class="author-description">
                        Practitioner and student of Bazi (Chinese astrology) and Tarot.
                        Exploring the intersection of ancient wisdom and modern life.
                        Sharing insights on spirituality, divination, and personal growth.
                    </p>
                    <a href="{{ get_url(path='@/about.md') }}" class="author-link">More about me ‚Üí</a>
                </div>
            </div>
        </aside>
        {% endif %}

        <!-- Newsletter Signup -->
        {% if page.date %}
        {{ newsletter::post_end(
            title="Enjoyed this post?",
            description="Get more insights like this delivered to your inbox. Join readers exploring Bazi, Tarot, and mindful living."
        ) }}
        {% endif %}

        <!-- Post Footer -->
        <footer class="post-footer">
            <!-- Social Sharing -->
            <div class="share-buttons">
                <h3>Share this post</h3>
                <div class="share-btn-container">
                    <a href="https://twitter.com/intent/tweet?text={{ page.title }}&url={{ page.permalink }}" target="_blank" rel="noopener" class="share-btn twitter">
                        <span>üê¶</span> Twitter
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ page.permalink }}" target="_blank" rel="noopener" class="share-btn facebook">
                        <span>üìò</span> Facebook
                    </a>
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ page.permalink }}&title={{ page.title }}" target="_blank" rel="noopener" class="share-btn linkedin">
                        <span>üíº</span> LinkedIn
                    </a>
                    <button class="share-btn copy" id="copyLinkBtn" data-url="{{ page.permalink }}">
                        <span>üîó</span> <span class="copy-text">Copy Link</span>
                    </button>
                </div>
            </div>

            <!-- Navigation to previous/next posts -->
            {% if page.earlier or page.later %}
            <nav class="post-navigation">
                {% if page.earlier %}
                <a href="{{ page.earlier.permalink }}" class="nav-previous">
                    <span class="nav-label">&larr; Previous</span>
                    <span class="nav-title">{{ page.earlier.title }}</span>
                </a>
                {% endif %}
                {% if page.later %}
                <a href="{{ page.later.permalink }}" class="nav-next">
                    <span class="nav-label">Next &rarr;</span>
                    <span class="nav-title">{{ page.later.title }}</span>
                </a>
                {% endif %}
            </nav>
            {% endif %}
        </footer>
    </div>
</article>
{% endblock %}

{% block extra_js %}
<script>
// Copy Link Functionality
(function() {
    const copyBtn = document.getElementById('copyLinkBtn');
    if (copyBtn) {
        copyBtn.addEventListener('click', function() {
            const url = this.getAttribute('data-url');
            const copyText = this.querySelector('.copy-text');

            navigator.clipboard.writeText(url).then(() => {
                const originalText = copyText.textContent;
                copyText.textContent = 'Copied!';
                this.classList.add('copied');

                setTimeout(() => {
                    copyText.textContent = originalText;
                    this.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                copyText.textContent = 'Failed';
                setTimeout(() => {
                    copyText.textContent = 'Copy Link';
                }, 2000);
            });
        });
    }
})();
</script>
{% endblock %}
